<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>카카오 로그인 성공</title>
  <!-- Tailwind CSS CDN을 사용하여 기본적인 스타일링을 적용합니다. -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Inter 폰트 적용 (Tailwind CSS에서 기본으로 사용하는 폰트 중 하나) */
    body {
      font-family: 'Inter', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background-color: #f0f2f5;
    }
  </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
<div class="bg-white p-8 rounded-lg shadow-xl max-w-lg w-full text-center">
  <h1 class="text-3xl font-bold text-gray-800 mb-4">🎉 로그인 성공! 🎉</h1>
  <p class="text-gray-600 mb-6">환영합니다! 토큰 정보를 확인해 주세요.</p>

  <div class="bg-blue-50 border border-blue-200 rounded-md p-4 mb-6">
    <h2 class="text-lg font-semibold text-blue-700 mb-2">수신된 JWT 토큰:</h2>
    <div id="tokenDisplay" class="break-all bg-blue-100 text-blue-800 p-3 rounded-md text-sm font-mono whitespace-pre-wrap">
      토큰을 불러오는 중...
    </div>
    <button id="copyButton" class="mt-4 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-md transition duration-300 ease-in-out shadow-md">
      토큰 복사
    </button>
  </div>

  <p class="text-sm text-gray-500 mt-6">이 페이지는 로그인 처리 후 토큰을 확인하기 위한 임시 페이지입니다.</p>
  <button id="goToMainButton" class="mt-4 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-md transition duration-300 ease-in-out shadow-md">
    메인 페이지로 이동
  </button>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const tokenDisplay = document.getElementById('tokenDisplay');
    const copyButton = document.getElementById('copyButton');
    const goToMainButton = document.getElementById('goToMainButton');

    // URL에서 'token' 쿼리 파라미터 값을 가져옵니다.
    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get('token');

    if (token) {
      tokenDisplay.textContent = token; // 토큰을 화면에 표시합니다.
      // 로컬 스토리지에 토큰을 저장합니다.
      localStorage.setItem('jwtToken', token);
      console.log('JWT Token successfully received and stored:', token);

      // history.replaceState를 사용하여 URL에서 토큰 정보를 제거합니다.
      // 이 작업은 브라우저의 뒤로 가기 기록에 토큰이 남지 않도록 합니다.
      const cleanUrl = window.location.origin + window.location.pathname;
      window.history.replaceState({}, document.title, cleanUrl);
    } else {
      tokenDisplay.textContent = '토큰을 찾을 수 없습니다. 로그인 과정에 문제가 있었을 수 있습니다.';
      tokenDisplay.classList.remove('bg-blue-100', 'text-blue-800');
      tokenDisplay.classList.add('bg-red-100', 'text-red-800');
      console.error('JWT Token not found in URL.');
    }

    // 토큰 복사 버튼 클릭 이벤트 리스너
    copyButton.addEventListener('click', () => {
      const tokenToCopy = tokenDisplay.textContent;
      if (tokenToCopy && tokenToCopy !== '토큰을 불러오는 중...' && !tokenToCopy.includes('찾을 수 없습니다')) {
        // document.execCommand('copy')는 구식이며 보안상 제한이 있을 수 있지만,
        // navigator.clipboard.writeText()는 iframe 환경에서 동작하지 않을 수 있으므로 사용합니다.
        const textArea = document.createElement("textarea");
        textArea.value = tokenToCopy;
        document.body.appendChild(textArea);
        textArea.select();
        try {
          document.execCommand('copy');
          alert('토큰이 클립보드에 복사되었습니다!'); // 실제 앱에서는 커스텀 모달 사용 권장
        } catch (err) {
          console.error('클립보드 복사 실패:', err);
          alert('토큰 복사에 실패했습니다.');
        }
        document.body.removeChild(textArea);
      } else {
        alert('복사할 토큰이 없습니다.');
      }
    });

    // 메인 페이지로 이동 버튼 클릭 이벤트 리스너
    goToMainButton.addEventListener('click', () => {
      // 실제 애플리케이션의 메인 페이지 URL로 변경해주세요.
      window.location.href = '/'; // 또는 '/main', '/dashboard' 등
    });
  });

  // alert() 대신 사용할 간단한 커스텀 메시지 박스 예시 (프로덕션에서는 더 정교하게 구현)
  function alert(message) {
    const alertBox = document.createElement('div');
    alertBox.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background-color: #4CAF50;
                color: white;
                padding: 15px 25px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
                z-index: 1000;
                opacity: 0;
                transition: opacity 0.3s ease-in-out;
            `;
    alertBox.textContent = message;
    document.body.appendChild(alertBox);

    setTimeout(() => {
      alertBox.style.opacity = 1;
    }, 50);

    setTimeout(() => {
      alertBox.style.opacity = 0;
      alertBox.addEventListener('transitionend', () => alertBox.remove());
    }, 2000);
  }
</script>
</body>
</html>
